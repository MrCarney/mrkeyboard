units:
  #cx:18
  #cy:17
  # Proxy Spacing Variables
  kx: cx + 1
  ky: cy + 1
  # Padding Variables
  px: kx + 2
  py: ky + 2
  #$default_width: kx
  #$default_height: ky
  #$default_autobind: 11
  thumb_radius: ((5kx/2+1)^2 + (5ky/2)^2)^0.5
  phi: atan((5ky/2)/(5kx/2+1)) - pi/6
  thumb_2high_hypotenuse: ((kx/2)^2 + (3ky/2)^2)^0.5
points:
  key:
    padding: ky
    spread: kx
  zones:
    left:
      anchor:
        shift: [50, -160]
      columns:
        far:
          key:
            splay: 8.5
            column_net: P2
          rows:
            arrows:
              shift: [-1,0]
              key:
                led_next: L2930
                led_prev: L2229
            bottom.key:
              led_next: L2229
              led_prev: L2322
            home.key:
              led_next: L1516
              led_prev: L0815
            top.key:
              led_next: L0815
              led_prev: L0908
            number.key:
              led_next: L0102
              led_prev: P1
        pinkie:
          key:
            stagger: -1.5
            column_net: P3
          rows:
            arrows:
              shift: [-1,0]
              key.led_next: L3031
              key.led_prev: L2930
            bottom:
              key.led_next: L2322
              key.led_prev: L2423
            home:
              key.led_next: L1617
              key.led_prev: L1516
            top:
              key.led_next: L0908
              key.led_prev: L1009
            number:
              key.led_next: L0203
              key.led_prev: L0102
        ring:
          key:
            splay: -3.5
            column_net: P4
          rows:
            arrows:
              shift: [-0.5,0]
              key.led_next: L3132
              key.led_prev: L3031
            bottom:
              key.led_next: L2423
              key.led_prev: L2524
            home:
              key.led_next: L1718
              key.led_prev: L1617
            top:
              key.led_next: L1009
              key.led_prev: L1110
            number:
              key.led_next: L0304
              key.led_prev: L0203
        middle:
          key:
            splay: -5
            stagger: 2
            column_net: P5
          rows:
            arrows:
              shift: [0.25,0]
              key.led_next: L3233
              key.led_prev: L3132
            bottom:
              key.led_next: L2524
              key.led_prev: L2625
            home:
              key.led_next: L1819
              key.led_prev: L1718
            top:
              key.led_next: L1110
              key.led_prev: L1211
            number:
              key.led_next: L0405
              key.led_prev: L0304
        index:
          key:
            column_net: P6
            stagger: -3
          rows:
            arrows:
              shift: [0.25,0]
              key.led_next: L3334
              key.led_prev: L3233
            bottom:
              key.led_next: L2625
              key.led_prev: L2726
            home:
              key.led_next: L1920
              key.led_prev: L1819
            top:
              key.led_next: L1211
              key.led_prev: L1312
            number:
              key.led_next: L0506
              key.led_prev: L0405
        indexplus:
          key:
            column_net: P7
            stagger: -4
          rows:
            arrows:
              shift: [0.25,0]
              skip: true
            bottom:
              key.led_next: L2726
              key.led_prev: L2827
            home:
              key.led_next: L2021
              key.led_prev: L1920
            top:
              key.led_next: L1312
              key.led_prev: L1413
            number:
              key.led_next: L0607
              key.led_prev: L0506
        inside:
          key:
            column_net: P16
          rows:
            arrows:
              shift: [0.25,0]
              skip: true
            bottom:
              key.led_next: L2827
              key.led_prev: L2128
            home:
              key.led_next: L2128
              key.led_prev: L2021
            top:
              key.led_next: L1413
              key.led_prev: L0714
            number:
              key.led_next: L0714
              key.led_prev: L0607
      rows:
        arrows:
          row_net: P14
        bottom:
          row_net: P15
        home:
          row_net: P18
        top:
          row_net: P19
        number:
          row_net: P20
    left_thumb:
      anchor:
        ref: left_indexplus_arrows
        shift: [-4,-21]       
      key:
        column_net: P9
        stagger: -2.5
      columns:
        inside:
          rows:
            bottom:
              rotate: 35
              splay: -60
              shift: [-3,0]
              row_net: P14
              key.led_next: L3435
              key.led_prev: L3334
        center:
          rows:
            bottom:
              shift: [3,2.5]
              row_net: P15
              key.led_next: L3536
              key.led_prev: L3435
        outside:
          rows:
            bottom:
              shift: [6,5]
              row_net: P18
              key.led_next:
              key.led_prev: L3536
      rows:
        bottom:
  mirror: &mirror
    ref: left_inside_number
    distance: 5kx
outlines:
  polygon_left:
    - what: polygon
      points:
        - ref: left_far_number
          shift: [-px,py]
        - ref: left_far_arrows
          shift: [-px,-py]
        - ref: left_thumb_inside_bottom
          shift: [-px,-py]
        - ref: left_thumb_outside_bottom
          shift: [px,-py]
        - ref: left_thumb_outside_bottom
          shift: [px,2py-2.25]
        - ref: left_inside_bottom
          shift: [kx/2+32.75,-3*ky]
        - ref: left_middle_number
          shift: [3.5*kx+32.75,py]
        - ref: left_inside_number
          shift: [0,27]
        - ref: left_inside_number
          shift: [-kx/2,27]
        - ref: left_inside_number
          shift: [-kx,27]
        - ref: left_middle_number
          shift: [0,py-1.6]
  roundedpoly_left:
    - what: outline
      name: polygon_left
      fillet: 10
  arc_circle:
    - what: circle
      adjust:
        ref: left_middle_number
        shift: [0,-20]
      radius: 700
  arc_rectangle:
    - what: rectangle
      adjust:
        ref: left_middle_number
        shift: [0,-24]
      size: 1400
  arc_top:
    - name: arc_circle
    - name: arc_rectangle
      operation: subtract
  top_right_fillet:
    - what: rectangle
      adjust:
        ref: left_inside_number
        shift: [34.75,19.5]
      size: 15
      fillet: 5
  top_right_rectangle_left:
    - what: rectangle
      adjust:
        ref: left_inside_number
        shift: [30,19]
      size: 15
  top_right_rectangle_bottom:
    - what: rectangle
      adjust:
        ref: left_inside_number
        shift: [34,16]
      size: 15
  top_right_rectangle:
    - name: top_right_rectangle_bottom
    - name: top_right_rectangle_left
      operation: add
  top_right_curve:
    - name: top_right_fillet
    - name: top_right_rectangle
      operation: add
  combined_left:
    - name: roundedpoly_left
    - name: top_right_curve
    - name: arc_top
      adjust:
        shift: [34,-667.725]
        rotate: 4
      operation: add
  polygon_right:
    - what: polygon
      points:
        - ref: mirror_left_far_number
          shift: [-px,py]
        - ref: mirror_left_far_arrows
          shift: [-px,-py]
        - ref: mirror_left_thumb_inside_bottom
          shift: [-px,-py]
        - ref: mirror_left_thumb_outside_bottom
          shift: [px,-py]
        - ref: mirror_left_thumb_outside_bottom
          shift: [px,2py-2.25]
        - ref: mirror_left_inside_bottom
          shift: [kx/2+32.75,-3*ky]
        - ref: mirror_left_middle_number
          shift: [3.5*kx+32.75,py]
        - ref: mirror_left_inside_number
          shift: [0,27]
        - ref: mirror_left_inside_number
          shift: [-kx/2,27]
        - ref: mirror_left_inside_number
          shift: [-kx,27]
        - ref: mirror_left_middle_number
          shift: [0,py-1.6]
  roundedpoly_right:
    - what: outline
      name: polygon_right
      fillet: 10
  top_left_fillet:
    - what: rectangle
      adjust:
        ref: mirror_left_inside_number
        shift: [34.75,19.5]
      size: 15
      fillet: 5
  top_left_rectangle_right:
    - what: rectangle
      adjust:
        ref: mirror_left_inside_number
        shift: [30,19]
      size: 15
  top_left_rectangle_bottom:
    - what: rectangle
      adjust:
        ref: mirror_left_inside_number
        shift: [34,16]
      size: 15
  top_left_rectangle:
    - name: top_left_rectangle_bottom
    - name: top_left_rectangle_right
      operation: add
  top_left_curve:
    - name: top_left_fillet
    - name: top_left_rectangle
      operation: add
  combined_right:
    - name: roundedpoly_right
    - name: top_left_curve
    - name: arc_top
      adjust:
        shift: [176.5,-653.05]
        rotate: -4
      operation: add
  switch_cutouts_left:
    left:
      what: rectangle
      where: /^left_.*/
      size: 13.8
  switch_cutouts_right:
    right:
      what: rectangle
      where: /^mirror_.*/
      size: 13.8
  test_print_left:
    - name: combined_left
    - name: switch_cutouts_left
      operation: subtract
  test_print_right:
    - name: combined_right
    - name: switch_cutouts_right
      operation: subtract
pcbs:
  mrkeyboard_left:
    outlines:
      left:
        outline: combined_left
    footprints:
      choc_hotswap:
        what: choc
        params:
          keycaps: true
          reverse: false
          hotswap: true
          from: "{{column_net}}"
          to: "{{colrow}}"
        where: /^left_.*/
        adjust:
          rotate: 180
      diode:
        what: diode_smd_backonly
        params:
          from: "{{colrow}}"
          to: "{{row_net}}"
        where: /^left_.*/
        adjust:
          shift: [-8, 3.5]
          rotate: 270
      rgb:
        what: rgb
        params:
          din: "{{key.led_prev}}"
          dout: "{{key.led_next}}"
          VCC: VCC
          GND: GND
        where: /^left_.*/
        adjust:
          shift: [0, 4.7]
      promicro:
        what: promicro
        params:
          orientation: "up"
        where:
          ref: left_middle_number
          shift: [3.5*kx+32.75/2,py-17.78-.15]
          rotate: -90
      trrs:
        what: trrs
        where:
          ref: left_inside_home
          shift: [42.25, 10]
          rotate: -90
        params:
          A: GND
          B: GND
          C: P21
          D: VCC
          reverse: false
          symmetric: false
      knob:
        what: rotary
        where:
          ref: left_inside_bottom
          shift: [0.128+0.5kx, -1.5ky]
        params:
          from: P9
          to: P19
          A: P8
          B: GND
          C: P10
  mrkeyboard_right:
    outlines:
      right:
        outline: combined_right
    footprints:
      choc_hotswap:
        what: choc
        params:
          keycaps: true
          reverse: false
          hotswap: true
          from: "{{column_net}}"
          to: "{{colrow}}"
        where: /^mirror_.*/
        adjust:
          rotate: 180
      diode:
        what: diode_smd_backonly
        params:
          from: "{{colrow}}"
          to: "{{row_net}}"
        where: /^mirror_.*/
        adjust:
          shift: [8, 3.5]
          rotate: 90
      rgb:
        what: rgb
        params:
          din: "{{key.led_prev}}"
          dout: "{{key.led_next}}"
          VCC: VCC
          GND: GND
        where: /^mirror_.*/
        adjust:
          shift: [0, 4.7]
      promicro:
        what: promicro
        params:
          orientation: "up"
        where:
          ref: mirror_left_middle_number
          shift: [3.5*kx+32.75/2,py-17.78]
          rotate: 90
      trrs:
        what: trrs
        where:
          ref: mirror_left_inside_home
          shift: [42.25, 10]
          rotate: -90
        params:
          A: GND
          B: GND
          C: P10
          D: VCC
          reverse: false
          symmetric: false
cases:
  left:
    - name: combined_left
      operation: add
      extrude: 1
  right:
    - name: combined_right
      operation: add
      extrude: 1